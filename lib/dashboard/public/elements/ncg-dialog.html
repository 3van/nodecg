<link rel="import" href="/components/polymer/polymer.html">
<link rel="import" href="/components/neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="/components/paper-dialog-behavior/paper-dialog-behavior.html">
<link rel="import" href="/components/paper-dialog-behavior/paper-dialog-shared-styles.html">

<dom-module id="ncg-dialog">
    <style>
        :host > ::content iframe {
            box-sizing: border-box;
        }

        :host > ::content iframe {
            margin: 0!important;
            padding: 0!important;
        }
    </style>

    <template>
        <style include="paper-dialog-shared-styles"></style>
        <content></content>
    </template>
</dom-module>

<script>

(function() {

    Polymer({

        is: 'ncg-dialog',

        behaviors: [
            Polymer.PaperDialogBehavior,
            Polymer.NeonAnimationRunnerBehavior
        ],

        properties: {
            panel: Object
        },

        listeners: {
            'neon-animation-finish': '_onNeonAnimationFinish',
            'iron-overlay-closed': '_onIronOverlayClosed'
        },

        _renderOpened: function() {
            if (this.withBackdrop) {
                this.backdropElement.open();
            }
            this.playAnimation('entry');
        },

        _renderClosed: function() {
            if (this.withBackdrop) {
                this.backdropElement.close();
            }
            this.playAnimation('exit');
        },

        _onNeonAnimationFinish: function() {
            if (this.opened) {
                this._finishRenderOpened();
            } else {
                this._finishRenderClosed();
            }
        },

        _onIronOverlayClosed: function(e) {
            var iframeDocument = this.querySelector('iframe').contentDocument;
            if (e.detail.confirmed) {
                iframeDocument.dispatchEvent(new CustomEvent('dialog-confirmed'));
            } else {
                iframeDocument.dispatchEvent(new CustomEvent('dialog-dismissed'));
            }
        }

    });

})();

</script>

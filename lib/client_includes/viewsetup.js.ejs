<% include nodecg-api.js %>

/**
 * In closure to avoid adding useless functions / config to global scope
 */
var nodecg = (function () {
  'use strict';

  var ncgConfig = <%- ncgConfig %>;
  var bundleConfig = <%- bundleConfig %>;
  var nodecg = new NodeCG('<%= bundleName %>', bundleConfig, ncgConfig);

  // Function to load socket.io before marking NodeCG API as ready
  function getScript(url, callback) {
    'use strict';

    // Create a script tag for socket.io and append it
    var newScript = document.createElement('script');
    newScript.type = 'text/javascript';
    newScript.src = url;
    newScript.onload = callback;

    document.getElementsByTagName('head')[0].appendChild(newScript);
  }

  getScript('/socket.io/socket.io.js', function() {
    'use strict';

    nodecg._setupAPI();
    var event = new Event("ncgReady");
    document.dispatchEvent(event);
  });

  return nodecg;
})();
